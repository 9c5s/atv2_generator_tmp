import{q as et}from"./chunk-JIHS3ZDA.js";import{a as C}from"./chunk-AWGLQW6G.js";import{o as J}from"./chunk-I3RHSA6D.js";import{h as N}from"./chunk-KLXVAUUB.js";import{B as q,w as Z}from"./chunk-KZ3A2NRO.js";import{a as tt}from"./chunk-ZNRADN3H.js";import{c as O,d as E,e as I,g as A,h as M,i as Q,j as v,k as W,l as X,n as R,o as Y}from"./chunk-264EOGRT.js";import{$a as c,Aa as m,Bc as G,Eb as L,H as y,Hb as w,Jb as x,S as h,Sa as _,W as g,_ as s,_a as p,a as k,ab as z,b as P,ba as j,gc as H,h as b,ic as K,lc as F,qc as V,r as S,t as d,tb as l,ub as f,v as D}from"./chunk-I424EGRW.js";function it(n){return"entity"in n}var U="digitalTicket",ct=A("[DigitalTicket] Set Tickets",M()),pt=A("[DigitalTicket] Set Ticket",M()),lt=A("[DigitalTicket] Remove Ticket",M()),u={setTickets:ct,setTicket:pt,removeTicket:lt},T=tt(),ut=T.getInitialState({ticketIdsByStatus:{active:[],expired:[]}}),mt=Y(ut,R(u.setTickets,(n,{tickets:i,init:a,status:t})=>{let r=k({},n.ticketIdsByStatus),e=i.map(o=>o.id);return r[t]=a?e:[...new Set([...n.ticketIdsByStatus[t],...e])],a?T.setAll(i,P(k({},n),{ticketIdsByStatus:r})):T.addMany(i,P(k({},n),{ticketIdsByStatus:r}))}),R(u.setTicket,(n,{ticket:i})=>T.upsertOne(i,n)),R(u.removeTicket,(n,{id:i})=>{let a=k({},n.ticketIdsByStatus);return Object.keys(a).forEach(t=>{a[t]=a[t].filter(r=>r!==i)}),T.removeOne(i,P(k({},n),{ticketIdsByStatus:a}))}));function rt(n,i){return mt(n,i)}var{selectEntities:nt}=T.getSelectors(),B=W(U),Tt=n=>v(v(B,i=>i.ticketIdsByStatus[n]),v(B,nt),(i,a)=>i.map(t=>a[t]).filter(t=>!!t)),dt=v(B,nt),bt=n=>v(dt,i=>{let a=i[n];return a&&it(a)?a:null});function yt(){return[X(U,rt)]}var ot=(()=>{let i=class i{constructor(){this.baseUrl="v1/private/digital_tickets",this.http=s(V)}fetchDigitalTickets({page:t,perPage:r,status:e}){let o=new F().set("page",t.toString()).set("per_page",r.toString());return e&&(o=o.set("status",e)),this.http.get(this.baseUrl,{params:o})}fetchDigitalTicketById(t){return this.http.get(`${this.baseUrl}/${t}`)}startTicketDistribution(t){return this.http.post(`${this.baseUrl}/${t}/start_distribution`,{})}cancelTicketDistribution(t){return this.http.post(`${this.baseUrl}/${t}/cancel_distribution`,{})}acceptTicketDistribution(t){return this.http.post(`${this.baseUrl}/accept_distribution`,{distributionKey:t})}previewTicketDistribution(t){let r=new F().set("distribution_key",t);return this.http.get(`${this.baseUrl}/preview_distribution`,{params:r})}returnTicket(t){return this.http.post(`${this.baseUrl}/${t}/return`,{})}};i.\u0275fac=function(r){return new(r||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var st=(()=>{let i=class i{constructor(){this.ticketPages={active:new O(50),expired:new O(50)},this.store=s(Q),this.ticketApi=s(ot)}fetchDigitalTickets({init:t,status:r}){let e=t?1:this.ticketPages[r].page+1;return this.ticketApi.fetchDigitalTickets({status:r,page:e,perPage:this.ticketPages[r].pageSize}).pipe(h(o=>{this.store.dispatch(u.setTickets({tickets:o,init:t,status:r})),this.ticketPages[r].page=e,this.ticketPages[r].setPage(o)}))}fetchDigitalTicketById(t){return this.ticketApi.fetchDigitalTicketById(t).pipe(h(r=>{this.store.dispatch(u.setTicket({ticket:r}))}))}startTicketDistribution(t){let r=this.ticketApi.startTicketDistribution(t).pipe(h(e=>{this.store.dispatch(u.setTicket({ticket:e}))}),D(e=>E(e)),y(e=>S(I(new C("\u5206\u914D\u306E\u958B\u59CB\u306B\u5931\u6557\u3057\u307E\u3057\u305F",{originalErrorResponse:e})))));return d(r)}cancelTicketDistribution(t){let r=this.ticketApi.cancelTicketDistribution(t).pipe(h(e=>{this.store.dispatch(u.setTicket({ticket:e}))}),D(e=>E(e)),y(e=>S(I(new C("\u5206\u914D\u306E\u7D42\u4E86\u306B\u5931\u6557\u3057\u307E\u3057\u305F",{originalErrorResponse:e})))));return d(r)}acceptTicketDistribution(t){let r=this.ticketApi.acceptTicketDistribution(t).pipe(h(e=>{this.store.dispatch(u.setTicket({ticket:e}))}),D(e=>E(e)),y(e=>S(I(new C("\u30C1\u30B1\u30C3\u30C8\u306E\u53D7\u53D6\u306B\u5931\u6557\u3057\u307E\u3057\u305F",{originalErrorResponse:e})))));return d(r)}previewTicketDistribution(t){return this.ticketApi.previewTicketDistribution(t)}returnTicket(t){let r=this.ticketApi.returnTicket(t).pipe(h(()=>{this.store.dispatch(u.removeTicket({id:t}))}),D(()=>E(!0)),y(e=>S(I(new C("\u30C1\u30B1\u30C3\u30C8\u306E\u8FD4\u5374\u306B\u5931\u6557\u3057\u307E\u3057\u305F",{originalErrorResponse:e})))));return d(r)}};i.\u0275fac=function(r){return new(r||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Gt=(()=>{let i=class i{constructor(){this.router=s(G),this.clipboard=s(J),this.alertService=s(q),this.toastService=s(N),this.loaderService=s(Z),this.ticketService=s(st)}startTicketDistribution(t){return b(this,null,function*(){if(!(yield this.alertService.showConfirmation({header:"\u78BA\u8A8D",message:"\u30C1\u30B1\u30C3\u30C8\u306E\u5206\u914D\u3092\u958B\u59CB\u3057\u307E\u3059\u304B\uFF1F",buttonText:"\u5206\u914D\u3059\u308B"})))return;let e=this.loaderService.showLoader({message:"\u901A\u4FE1\u4E2D..."}),o=yield this.ticketService.startTicketDistribution(t);if(e.close(),o.isFailure()){yield this.alertService.showErrorAlertFromResponse(o.error.originalErrorResponse,o.error.message);return}return o.value.distributionUrl&&this.copyToClipboard(o.value.distributionUrl),o.value})}cancelTicketDistribution(t){return b(this,null,function*(){if(!(yield this.alertService.showConfirmation({header:"\u78BA\u8A8D",message:"\u5206\u914D\u3092\u7D42\u4E86\u3059\u308B\u3068\u30EA\u30F3\u30AF\u304C\u7121\u52B9\u306B\u306A\u308A\u307E\u3059\u3002<br />\u30C1\u30B1\u30C3\u30C8\u306E\u5206\u914D\u3092\u7D42\u4E86\u3057\u307E\u3059\u304B\uFF1F",buttonText:"\u7D42\u4E86\u3059\u308B",buttonColor:"attention"})))return;let e=yield this.ticketService.cancelTicketDistribution(t);if(e.isFailure()){yield this.alertService.showErrorAlertFromResponse(e.error.originalErrorResponse,e.error.message);return}return this.toastService.open({message:"\u5206\u914D\u304C\u7D42\u4E86\u3057\u307E\u3057\u305F",duration:3e3}),e.value})}acceptTicketDistribution(t){return b(this,null,function*(){let r=this.loaderService.showLoader({message:"\u901A\u4FE1\u4E2D..."}),e=yield this.ticketService.acceptTicketDistribution(t);if(r.close(),e.isFailure()){let o=yield this.alertService.showErrorAlertFromResponse(e.error.originalErrorResponse,e.error.message);return yield d(o.closed),null}return this.toastService.open({message:"\u30C1\u30B1\u30C3\u30C8\u306E\u53D7\u3051\u53D6\u308A\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F",duration:3e3}),e.value})}copyToClipboard(t){this.clipboard.copy(t)&&this.toastService.open({message:"\u30C1\u30B1\u30C3\u30C8\u5206\u914DURL\u3092\u30B3\u30D4\u30FC\u3057\u307E\u3057\u305F",duration:3e3})}returnTicket(t){return b(this,null,function*(){if(!t.returnTo)return;if(!(yield this.alertService.showConfirmation({header:"\u78BA\u8A8D",message:`\u30C1\u30B1\u30C3\u30C8\u3092${t.returnTo==="entitled_user"?"\u7533\u8FBC\u8005":"\u540C\u884C\u8005"}\u3078\u8FD4\u5374\u3057\u307E\u3059\u304B\uFF1F`,buttonText:"\u8FD4\u5374\u3059\u308B",buttonColor:"attention"})))return!1;let e=yield this.ticketService.returnTicket(t.id);return e.isFailure()?(yield this.alertService.showErrorAlertFromResponse(e.error.originalErrorResponse,e.error.message),!1):(this.router.navigate(["/mypage/tickets"],{replaceUrl:!0}),this.toastService.open({message:"\u30C1\u30B1\u30C3\u30C8\u3092\u8FD4\u5374\u3057\u307E\u3057\u305F",duration:3e3}),!0)})}};i.\u0275fac=function(r){return new(r||i)},i.\u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var Wt=(()=>{let i=class i{};i.\u0275fac=function(r){return new(r||i)},i.\u0275cmp=j({type:i,selectors:[["tpl-ticket-act-info"]],inputs:{name:"name",act:"act"},standalone:!0,features:[L],decls:25,vars:19,consts:[[1,"ticket-head"],[1,"date"],[1,"number"],[1,"unit"],[1,"day-of-week"],[1,"title"],[1,"venue"],[1,"act-time",3,"act"]],template:function(r,e){r&1&&(p(0,"div",0)(1,"div",1)(2,"span",2),l(3),w(4,"date"),c(),p(5,"span",3),l(6,"\u5E74"),c(),p(7,"span",2),l(8),w(9,"date"),c(),p(10,"span",3),l(11,"\u6708"),c(),p(12,"span",2),l(13),w(14,"date"),c(),p(15,"span",3),l(16,"\u65E5"),c(),p(17,"span",4),l(18),w(19,"date"),c()(),p(20,"div",5),l(21),c(),p(22,"div",6),l(23),c(),z(24,"tpl-reception-act-time",7),c()),r&2&&(m(3),f(x(4,7,e.act.performanceDate,"yyyy")),m(5),f(x(9,10,e.act.performanceDate,"M")),m(5),f(x(14,13,e.act.performanceDate,"d")),m(5),f(x(19,16,e.act.performanceDate,"(E)")),m(3),f(e.name),m(2),f(e.act.venue),m(),_("act",e.act))},dependencies:[K,H,et],styles:[".ticket-head[_ngcontent-%COMP%]{background:var(--tpl-color-item-background-accent);padding:12px 16px}.ticket-head[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{align-items:baseline;display:flex;font-size:1.6rem;gap:2px;margin-bottom:8px}.ticket-head[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .number[_ngcontent-%COMP%]{display:inline-block;font-size:1.8rem;font-weight:600}.ticket-head[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .unit[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:400}.ticket-head[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;margin-bottom:4px}.ticket-head[_ngcontent-%COMP%]   .venue[_ngcontent-%COMP%]{font-size:1.7rem;font-weight:400}.ticket-head[_ngcontent-%COMP%]   .act-time[_ngcontent-%COMP%]{--font-size: 1.4rem;margin-top:4px}"],changeDetection:0});let n=i;return n})();export{Wt as a,Tt as b,bt as c,st as d,Gt as e,yt as f};
//# sourceMappingURL=chunk-2PK7G26J.js.map
