import{a as me}from"./chunk-XH3XDIPR.js";import{b as h,c as ie,d as de,l as g,m as fe}from"./chunk-FOLYN2CC.js";import{d as ue,e as ce,f as le,g as pe}from"./chunk-AWGLQW6G.js";import{n as Y,o as Z,r as q,s as ee,t as te,y as re,z as ne}from"./chunk-KZ3A2NRO.js";import{d as he}from"./chunk-UZVF6O5E.js";import{a as oe}from"./chunk-DBRRJBUZ.js";import{i as ae,l as se}from"./chunk-264EOGRT.js";import{$a as p,Aa as P,Bc as X,Eb as $,F as D,Kb as z,Na as U,Qa as b,Sa as V,W as c,Wb as L,X as j,Y as F,Z as f,_ as a,_a as l,ab as N,ba as R,ca as B,eb as E,gb as _,h as m,ib as O,ic as Q,ka as C,la as k,mb as J,na as T,nb as G,ob as W,r as x,rc as K,t as S,tb as d,ub as H,v,x as y,z as I}from"./chunk-I424EGRW.js";var Ce=["defaultView"];function ke(o,n){}function Te(o,n){if(o&1){let e=E();l(0,"div",3)(1,"h2",4),d(2,"\u65B0\u898F\u4F1A\u54E1\u767B\u9332\u3092\u3054\u5E0C\u671B\u306E\u65B9"),p(),l(3,"div",5)(4,"button",6),_("click",function(){C(e);let r=O();return k(r.signUp())}),d(5," \u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u4F5C\u6210 "),p()(),l(6,"p",7),d(7," \u672C\u30B5\u30FC\u30D3\u30B9\u306E\u3054\u5229\u7528\u306B\u306F\u4F1A\u54E1\u767B\u9332\u304C\u5FC5\u8981\u3067\u3059\u3002 "),N(8,"br"),d(9," \u3054\u767B\u9332\u3055\u308C\u308B\u65B9\u306F\u300C\u30A2\u30AB\u30A6\u30F3\u30C8\u3092\u4F5C\u6210\u300D\u3088\u308A\u767B\u9332\u753B\u9762\u3078\u304A\u9032\u307F\u304F\u3060\u3055\u3044\u3002 "),p()(),l(10,"div",8)(11,"h2",4),d(12,"\u3059\u3067\u306B\u4F1A\u54E1\u306E\u65B9"),p(),l(13,"div",9)(14,"button",10),_("click",function(){C(e);let r=O();return k(r.signIn())}),d(15," \u30ED\u30B0\u30A4\u30F3 "),p()()()}}var ge=(()=>{let n=class n extends me{constructor(){super(...arguments),this.portalKey="authModalContentComponent",this.dialogRef=a(q),this.sessionService=a(h),this.dialogData=a(ee)}get headerText(){return this.dialogData.headerText??"\u7533\u8FBC\u307F\u306B\u306F\u30ED\u30B0\u30A4\u30F3\u304C\u5FC5\u8981\u3067\u3059"}get returnPath(){return this.dialogData.returnPath}ngAfterViewInit(){this.updateView()}signUp(){this.sessionService.navigateSignUp(this.returnPath?{returnPath:this.returnPath}:{})}signIn(){this.sessionService.navigateSignIn(this.returnPath?{returnPath:this.returnPath}:{})}close(){this.dialogRef.close()}};n.\u0275fac=(()=>{let t;return function(i){return(t||(t=T(n)))(i||n)}})(),n.\u0275cmp=R({type:n,selectors:[["tpl-auth-modal"]],viewQuery:function(r,i){if(r&1&&J(Ce,7),r&2){let s;G(s=W())&&(i.defaultView=s.first)}},standalone:!0,features:[U,$],decls:6,vars:2,consts:[["defaultView",""],[3,"close"],[3,"cdkPortalOutlet"],[1,"group","sign-up"],[1,"title"],[1,"action","sign-up-action"],["tpl-button","","color","accent","width","fixed","buttonType","filled","icon","arrow-right",3,"click"],[1,"sign-up-note"],[1,"group","sign-in"],[1,"action"],["tpl-button","","color","basic","width","fixed","buttonType","filled","icon","arrow-right",3,"click"]],template:function(r,i){if(r&1){let s=E();l(0,"tpl-modal",1),_("close",function(){return C(s),k(i.close())}),l(1,"tpl-modal-header"),d(2),p(),b(3,ke,0,0,"ng-template",2),p(),b(4,Te,16,0,"ng-template",null,0,z)}r&2&&(P(2),H(i.headerText),P(),V("cdkPortalOutlet",i.portal))},dependencies:[Q,Z,Y,oe,re,ne],styles:["tpl-modal[_ngcontent-%COMP%]{--modal-content-background: var(--tpl-color-background)}.group[_ngcontent-%COMP%]{padding-top:8px}.group[_ngcontent-%COMP%] + .group[_ngcontent-%COMP%]{border-top:1px solid var(--tpl-color-border);margin-top:20px;padding-top:20px}.group[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:16px}.group[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:column;justify-content:center;margin-bottom:16px}.group[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%] > button[tpl-button][_ngcontent-%COMP%]{font-size:1.3rem}.group[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%] > button[tpl-button][_ngcontent-%COMP%] + button[tpl-button][_ngcontent-%COMP%]{margin-top:8px}.sign-up-note[_ngcontent-%COMP%]{font-size:14px;line-height:1.7}.sign-in[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{margin:24px 0}"],changeDetection:0});let o=n;return o})();var we=(()=>{let n=class n{constructor(){this.dialog=a(te)}openAuthModal({returnPath:t,headerText:r}={}){return this.dialog.open(ge,{maxWidth:"580px",width:"95%",data:{returnPath:t,headerText:r}})}};n.\u0275fac=function(r){return new(r||n)},n.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Ze=()=>m(void 0,null,function*(){let o=a(g),n=a(de),e=a(h),t=yield o.retrieveToken();return t&&(t.isExpired?e.signOut():yield S(n.fetchCurrentUser()).catch(()=>null)),!0}),qe=(o,n)=>m(void 0,null,function*(){let e=a(h),t=a(X),r=a(we);if(yield S(e.isSignedIn$))return!0;{let s=r.openAuthModal({returnPath:n.url,headerText:"\u767B\u9332\u304C\u5FC5\u8981\u3067\u3059"});return yield S(s.closed),t.parseUrl("/")}});var ct=(()=>{let n=class n extends h{constructor(){super(...arguments),this.store=a(ae),this.storage=a(ie),this.oauthService=a(fe)}get isSignedIn$(){return this.store.select(pe).pipe(D(t=>t!==void 0),v(t=>!!t))}navigateSignUp({returnPath:t}={}){this.oauthService.authWithRedirect({registration:!0,returnPath:t})}navigateSignIn({returnPath:t}={}){this.oauthService.authWithRedirect({returnPath:t})}signOut(){return m(this,null,function*(){return this.store.dispatch(ce.signOut()),yield this.storage.clear(),sessionStorage.clear(),yield this.oauthService.signOut(this.getPathAfterSignOut()),!0})}getPathAfterSignOut(){let t=window.location.pathname;return["/receptions","/booths"].some(i=>t.startsWith(i))?t:"/"}};n.\u0275fac=(()=>{let t;return function(i){return(t||(t=T(n)))(i||n)}})(),n.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var w=new F("JWT_OPTIONS"),Se=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,s,u,ve=0;u=e.charAt(ve++);~u&&(s=i%4?s*64+u:u,i++%4)?r+=String.fromCharCode(255&s>>(-2*i&6)):0)u=t.indexOf(u);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let r=this.getTokenExpirationDate(e);return t=t||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(f(w))},o.\u0275prov=c({token:o,factory:o.\u0275fac}),o})(),xe=o=>o instanceof Promise?I(()=>o):x(o),_e=(()=>{class o{constructor(e,t,r){this.jwtHelper=t,this.document=r,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||e.authScheme===""?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}isAllowedDomain(e){let t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;let r=`${t.hostname}${t.port&&!this.standardPorts.includes(t.port)?":"+t.port:""}`;return this.allowedDomains.findIndex(i=>typeof i=="string"?i===r:i instanceof RegExp?i.test(r):!1)>-1}isDisallowedRoute(e){let t=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex(r=>{if(typeof r=="string"){let i=new URL(r,this.document.location.origin);return i.hostname===t.hostname&&i.pathname===t.pathname}return r instanceof RegExp?r.test(e.url):!1})>-1}handleInterception(e,t,r){let i=this.jwtHelper.getAuthScheme(this.authScheme,t);if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let s=x(!1);return this.skipWhenExpired&&(s=e?xe(this.jwtHelper.isTokenExpired(e)):x(!0)),e?s.pipe(v(u=>u&&this.skipWhenExpired?t.clone():t.clone({setHeaders:{[this.headerName]:`${i}${e}`}})),y(u=>r.handle(u))):r.handle(t)}intercept(e,t){if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);let r=this.tokenGetter(e);return xe(r).pipe(y(i=>this.handleInterception(i,e,t)))}}return o.\u0275fac=function(e){return new(e||o)(f(w),f(Se),f(L))},o.\u0275prov=c({token:o,factory:o.\u0275fac}),o})(),kt=(()=>{class o{constructor(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:o,providers:[{provide:K,useClass:_e,multi:!0},e.jwtOptionsProvider||{provide:w,useValue:e.config},Se]}}}return o.\u0275fac=function(e){return new(e||o)(f(o,12))},o.\u0275mod=B({type:o}),o.\u0275inj=j({}),o})();var A=(()=>{let n=class n{constructor(){this.config=a(he)}get apiEndpoint(){return this.config.apiEndpoint}};n.\u0275fac=function(r){return new(r||n)},n.\u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function Me(){let o=a(g),n=a(A);return{tokenGetter:e=>m(this,null,function*(){return e?.url?(yield o.getApiAccessTokenSnapshotFromStore())??"anonymous":o.getApiAccessTokenFromStore()}),allowedDomains:[new RegExp(`${new URL(n.apiEndpoint).host.replace(/\./g,"\\.")}`)],disallowedRoutes:[/public\//,/v1\/auth\/.+/]}}var It={provide:w,useFactory:Me,deps:[g,A]};function Rt(){return[se(ue,le)]}export{ge as a,we as b,Ze as c,qe as d,ct as e,kt as f,A as g,It as h,Rt as i};
//# sourceMappingURL=chunk-JSBJBRQD.js.map
